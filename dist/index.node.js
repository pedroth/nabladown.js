!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NablaDown=t():e.NablaDown=t()}(global,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t){e.exports=require("@babel/runtime/helpers/esm/toConsumableArray")},function(e,t){e.exports=require("katex")},function(e,t){e.exports=require("prismjs")},function(e,t,r){"use strict";r.r(t),r.d(t,"parse",(function(){return s})),r.d(t,"render",(function(){return k}));var n=r(0),i=r.n(n);function u(e,t){return{left:e,right:t}}function o(e){var t=i()(e);return{next:function(){return o(t.slice(1))},peek:function(){return t[0]},hasNext:function(){return t.length>=1},isEmpty:function(){return 0===t.length},toString:function(){return t.map((function(e){return"string"==typeof e?e:JSON.stringify(e)})).join("")},filter:function(e){return o(t.filter(e))},log:function(){for(var e=o(t);e.hasNext();)console.log(e.peek()),e=e.next()}}}function c(){for(var e=null,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=0;i<r.length;i++)try{return r[i]()}catch(t){e=t}throw e}function a(e,t){return function(r){for(var n=0;n<e.length;n++)if(e[n].predicate(r))return e[n].value(r);return t}}function f(e,t){return function(r){for(var n=t,i=r,o=[];i.peek()===e&&n>=0;)n--,o.push(i.peek()),i=i.next();var c=t-n;if(c>0)return u({type:e,repeat:c,text:o.join("")},i);throw new Error("Error occurred while tokening repeated #".concat(t,", with symbol ").concat(e," ")+i.toString())}}function l(e){return function(t){for(var r=i()(e),n=t,o=0;o<r.length;){if(n.peek()!==r[o])throw new Error("Error occurred while tokening unique symbol ".concat(e," ")+auxStream.toString());o++,n=n.next()}return u({type:e,repeat:1,text:e},n)}}function p(e){for(var t=i()("*#$[]()\n "),r=[],n=e;n.hasNext()&&!t.includes(n.peek());)r.push(n.peek()),n=n.next();return u({type:"text",text:r.join("")},n)}function s(e){var t=function e(t){return c((function(){var r=function(e){var t=function(e){return c((function(){var t=y(e);return u({type:"statement",Title:t.left},t.right)}),(function(){var t=d(e);return u({type:"statement",Seq:t.left},t.right)}))}(e),r=t.left,n=t.right;if("\n"===n.peek().type)return u({type:"expression",Statement:r},n.next());throw new Error("Error occurred while parsing expression,"+n.toString())}(t),n=r.left,i=r.right,o=e(i);return u({type:"program",expression:n,program:o.left},o.right)}),(function(){return u({type:"program",expression:null,program:null},t)}))}(function(e){for(var t=[],r=e;r.hasNext();){var n=c((function(){return f("#",6)(r)}),(function(){return f("$",2)(r)}),(function(){return f("*",2)(r)}),(function(){return f("+",3)(r)}),(function(){return f("`",3)(r)}),(function(){return l("\n")(r)}),(function(){return l("[")(r)}),(function(){return l("]")(r)}),(function(){return l("(")(r)}),(function(){return l(")")(r)}),(function(){return l(" ")(r)}),(function(){return p(r)})),i=n.left,u=n.right;t.push(i),r=u}return o(t)}(o(e)));return console.log("Parse tree",t.left),t.left}function y(e){if("#"===e.peek().type){var t=e.peek().repeat,r=d(" "===e.next().peek().type?e.next().next():e.next());return u({type:"title",Seq:r.left,level:t},r.right)}throw new Error("Error occurred while parsing Title,"+nextStream.toString())}function d(e){return c((function(){var t=v(e),r=t.left,n=d(t.right);return u({type:"seq",SeqTypes:r,Seq:n.left},n.right)}),(function(){return u({type:"seq",isEmpty:!0},e)}))}function v(e){return c((function(){var t=g(e);return u({type:"seqTypes",Formula:t.left},t.right)}),(function(){var t=function(e){var t=e.peek(),r=t.repeat,n=new Error("Error occurred while parsing Html,"+e.toString());if("+"===t.type&&3===r){var i=x((function(e){return["+"].includes(e.type)&&3===(null==e?void 0:e.repeat)}))(e.next()),o=i.left,c=i.right,a=c.peek();if("+"===a.type&&(null==a?void 0:a.repeat)===r)return u({type:"html",html:o.textArray.join("")},c.next())}throw n}(e);return u({type:"seqTypes",Html:t.left},t.right)}),(function(){var t=function(e){if("["===e.peek().type){var t=function e(t){return c((function(){return c((function(){var r=g(t),n=r.left,i=r.right,o=e(i);return u({type:"linkStat",Formula:n,LinkStat:o.left},o.right)}),(function(){var r=x((function(e){return["\n","]"].includes(e.type)}))(t),n=r.left,i=r.right;if(0===n.textArray.length)throw new Error("Error occurred while parsing LinkStat,"+t.toString());var o=e(i);return u({type:"linkStat",AnyBut:n,LinkStat:o.left},o.right)}))}),(function(){return u({type:"linkStat",isEmpty:!0},t)}))}(e.next()),r=t.left,n=t.right;if("]"===n.peek().type){var i=n.next();if("("===i.peek().type){var o=x((function(e){return["\n",")"].includes(e.type)}))(i.next()),a=o.left,f=o.right;if(")"===f.peek().type)return u({type:"link",LinkStat:r,link:a.textArray.join("")},f.next())}}}throw new Error("Error occurred while parsing Link,"+e.toString())}(e);return u({type:"seqTypes",Link:t.left},t.right)}),(function(){var t=h(e);return u({type:"seqTypes",Italic:t.left},t.right)}),(function(){var t=m(e);return u({type:"seqTypes",Bold:t.left},t.right)}),(function(){var t=function(e){var t=e.peek();if(!["\n"].some((function(e){return t.type===e}))){return u({type:"text",text:t.text||""},e.next())}throw new Error("Error occurred while parsing Text,"+e.toString())}(e);return u({type:"seqTypes",Text:t.left},t.right)}))}function h(e){var t=e.peek();if("*"===t.type&&1===t.repeat){var r=v(e.next()),n=r.left,i=r.right,o=i.peek();if("*"===o.type&&1===o.repeat)return u({type:"italic",SeqTypes:n},i.next())}throw new Error("Error occurred while parsing Italic,"+nextStream.toString())}function m(e){var t=e.peek();if("*"===t.type&&2===t.repeat){var r=v(e.next()),n=r.left,i=r.right,o=i.peek();if("*"===o.type&&2===o.repeat)return u({type:"bold",SeqTypes:n},i.next())}throw new Error("Error occurred while parsing Italic,"+nextStream.toString())}function g(e){var t=e.peek(),r=t.repeat,n=new Error("Error occurred while parsing Formula,"+e.toString());if("$"===t.type){var i=x((function(e){return["$"].includes(e.type)}))(e.next()),o=i.left,c=i.right,a=c.peek();if("$"===a.type&&(null==a?void 0:a.repeat)===r)return u({type:"formula",equation:o.textArray.join(""),isInline:1===(null==a?void 0:a.repeat)},c.next())}throw n}function x(e){return function(t){return c((function(){var r=t.peek();if(!e(r)){var n=x(e)(t.next()),o=n.left,c=n.right;return u({type:"anyBut",textArray:[r.text].concat(i()(o.textArray))},c)}throw new Error("Error occurred while parsing AnyBut,"+t.toString())}),(function(){return u({type:"anyBut",textArray:[]},t)}))}}var E=r(1),S=r.n(E);r(2);function k(e){var t=function e(t){if(null===t.expression&&null===t.program)return[];var r=function(e){return t=e.Statement,a([{predicate:function(e){return!!e.Title},value:function(e){return t=e.Title,r=t.level,n=t.Seq,(i=document.createElement("h".concat(r))).appendChild(w(n)),i;var t,r,n,i}},{predicate:function(e){return!!e.Seq},value:function(e){return w(e.Seq)}}],document.createElement("div"))(t);var t}(t.expression),n=e(t.program);return[r].concat(i()(n))}(e),r=document.createElement("div");return t.forEach((function(e){return r.appendChild(e)})),r}function w(e){var t=document.createElement("div"),r=b(e);return 0===r.length?t.appendChild(document.createElement("br")):(r.forEach((function(e){return t.appendChild(e)})),t.setAttribute("style","display: flex; align-items: center"),t)}function b(e){if(e.isEmpty)return[];var t=q(e.SeqTypes),r=b(e.Seq);return[t].concat(i()(r))}function q(e){return a([{predicate:function(e){return!!e.Text},value:function(e){return t=e.Text,r=t.text,(n=document.createElement("pre")).innerHTML=r,n;var t,r,n}},{predicate:function(e){return!!e.Formula},value:function(e){return T(e.Formula)}},{predicate:function(e){return!!e.Html},value:function(e){return t=e.Html,r=t.html,(n=document.createElement("div")).innerHTML=r,Array.from(n.getElementsByTagName("script")).forEach((function(e){return evalScriptTag(e)})),n;var t,r,n}},{predicate:function(e){return!!e.Link},value:function(e){return function(e){var t=e.LinkStat,r=e.link,n=document.createElement("a");n.setAttribute("href",r),r.includes("http")&&n.setAttribute("target","_blank");var u=(o=t,c=document.createElement("div"),function(e){if(e.isEmpty)return[];var t=a([{predicate:function(e){return!!e.AnyBut},value:function(e){return t=e.AnyBut,r=t.textArray,(n=document.createElement("pre")).innerHTML=r.join(""),n;var t,r,n}},{predicate:function(e){return!!e.Formula},value:function(e){return T(e.Formula)}}],document.createElement("div"))(e),r=b(e.LinkStat);return[t].concat(i()(r))}(o).forEach((function(e){return c.appendChild(e)})),c.setAttribute("style","display: block ruby;"),c);var o,c;return n.appendChild(u),n}(e.Link)}},{predicate:function(e){return!!e.Italic},value:function(e){return t=e.Italic,r=t.SeqTypes,(n=document.createElement("em")).appendChild(q(r)),n;var t,r,n}},{predicate:function(e){return!!e.Bold},value:function(e){return t=e.Bold,r=t.SeqTypes,(n=document.createElement("strong")).appendChild(q(r)),n;var t,r,n}}],document.createElement("div"))(e)}function T(e){var t=S.a||{render:function(){}},r=e.equation,n=document.createElement("div");return e.isInline||n.setAttribute("style","flex-grow: 1"),t.render(r,n,{throwOnError:!1,displayMode:!e.isInline}),n}}])}));
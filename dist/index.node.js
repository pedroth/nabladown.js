!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.NablaDown=e():t.NablaDown=e()}(global,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var u=e[n]={i:n,l:!1,exports:{}};return t[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var u in t)r.d(n,u,function(e){return t[e]}.bind(null,u));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e){t.exports=require("@babel/runtime/helpers/esm/toConsumableArray")},function(t,e){t.exports=require("katex")},function(t,e,r){"use strict";r.r(e),r.d(e,"parse",(function(){return s})),r.d(e,"render",(function(){return x}));var n=r(0),u=r.n(n),i=r(1),o=r.n(i);function c(t,e){return{left:t,right:e}}function a(t){var e=u()(t);return{next:function(){return a(e.slice(1))},peek:function(){return e[0]},hasNext:function(){return e.length>=1},isEmpty:function(){return 0===e.length},toString:function(){return e.map((function(t){return"string"==typeof t?t:JSON.stringify(t)})).join("")},filter:function(t){return a(e.filter(t))}}}function f(){for(var t=null,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];for(var u=0;u<r.length;u++)try{return r[u]()}catch(e){t=e}throw t}function l(t,e){return function(r){for(var n=0;n<t.length;n++)if(t[n].predicate(r))return t[n].value(r);return e}}function p(t,e){return function(r){for(var n=e,u=r,i=[];u.peek()===t&&n>=0;)n--,i.push(u.peek()),u=u.next();var o=e-n;if(o>0)return c({type:t,repeat:o,text:i.join("")},u);throw new Error("Error occurred while tokening repeated #".concat(e,", with symbol ").concat(t," ")+u.toString())}}function d(t){return function(e){for(var r=u()(t),n=e,i=0;i<r.length;){if(n.peek()!==r[i])throw new Error("Error occurred while tokening unique symbol ".concat(t," ")+auxStream.toString());i++,n=n.next()}return c({type:t,repeat:1,text:t},n)}}function y(t){for(var e=u()("#$[]()\n"),r=[],n=t;n.hasNext()&&!e.includes(n.peek());)r.push(n.peek()),n=n.next();return c({type:"text",text:r.join("")},n)}function s(t){var e=function t(e){return f((function(){var r=function(t){var e=function(t){return f((function(){var e=v(t);return c({type:"statement",Title:e.left},e.right)}),(function(){var e=h(t);return c({type:"statement",Seq:e.left},e.right)}))}(t),r=e.left,n=e.right;if("\n"===n.peek().type)return c({type:"expression",Statement:r},n.next());throw new Error("Error occurred while parsing expression,"+n.toString())}(e),n=r.left,u=r.right,i=t(u);return c({type:"program",expression:n,program:i.left},i.right)}),(function(){return c({type:"program",expression:null,program:null},e)}))}(function(t){for(var e=[],r=t;r.hasNext();){var n=f((function(){return p("#",6)(r)}),(function(){return p("$",2)(r)}),(function(){return p("*",2)(r)}),(function(){return d("\n")(r)}),(function(){return d("[")(r)}),(function(){return d("]")(r)}),(function(){return d("(")(r)}),(function(){return d(")")(r)}),(function(){return y(r)})),u=n.left,i=n.right;e.push(u),r=i}return a(e)}(a(t)));return console.log("Parse tree",e.left),e.left}function v(t){if("#"===t.peek().type){var e=t.peek().repeat,r=h(t.next());return c({type:"title",Seq:r.left,level:e},r.right)}throw new Error("Error occurred while parsing Title,"+nextStream.toString())}function h(t){return f((function(){var e=function(t){return f((function(){var e=g(t);return c({type:"seqTypes",Formula:e.left},e.right)}),(function(){var e=function(t){if("["===t.peek().type){var e=function t(e){return f((function(){return f((function(){var r=g(e),n=r.left,u=r.right,i=t(u);return c({type:"linkStat",Formula:n,LinkStat:i.left},i.right)}),(function(){var r=m((function(t){return["\n","]"].includes(t.type)}))(e),n=r.left,u=r.right;if(0===n.textArray.length)throw new Error("Error occurred while parsing LinkStat,"+e.toString());var i=t(u);return c({type:"linkStat",AnyBut:n,LinkStat:i.left},i.right)}))}),(function(){return c({type:"linkStat",isEmpty:!0},e)}))}(t.next()),r=e.left,n=e.right;if("]"===n.peek().type){var u=n.next();if("("===u.peek().type){var i=m((function(t){return["\n",")"].includes(t.type)}))(u.next()),o=i.left,a=i.right;if(")"===a.peek().type)return c({type:"link",LinkStat:r,link:o.textArray.join("")},a.next())}}}throw new Error("Error occurred while parsing Link,"+t.toString())}(t);return c({type:"seqTypes",Link:e.left},e.right)}),(function(){var e=function(t){return f((function(){var e=function(t){var e=t.peek();if("*"===e.type&&1===e.repeat){var r=m((function(t){return"*"===t.type&&1===t.repeat})),n=r.left,u=r.right;return c({type:"italic",text:n},u.next())}throw new Error("Error occurred while parsing Italic,"+t.toString())}(t);return c({type:"text",Italic:e.left},e.right)}),(function(){var e=function(t){var e=t.peek();if("*"===e.type&&2===e.repeat){var r=m((function(t){return"*"===t.type&&2===t.repeat})),n=r.left,u=r.right;return c({type:"bold",text:n},u.next())}throw new Error("Error occurred while parsing Bold,"+t.toString())}(t);return c({type:"text",Bold:e.left},e.right)}),(function(){var e=t.peek();if("\n"!==e.type)return c({type:"text",text:e.text||""},t.next());throw new Error("Error occurred while parsing Text,"+t.toString())}))}(t);return c({type:"seqTypes",Text:e.left},e.right)}))}(t),r=e.left,n=h(e.right);return c({type:"seq",SeqTypes:r,Seq:n.left},n.right)}),(function(){return c({type:"seq",isEmpty:!0},t)}))}function g(t){var e=t.peek(),r=e.repeat,n=new Error("Error occurred while parsing Formula,"+t.toString());if("$"===e.type){var u=m((function(t){return["$"].includes(t.type)}))(t.next()),i=u.left,o=u.right,a=o.peek();if("$"===a.type&&(null==a?void 0:a.repeat)===r)return c({type:"formula",equation:i.textArray.join(""),isInline:1===(null==a?void 0:a.repeat)},o.next())}throw n}function m(t){return function(e){return f((function(){var r=e.peek();if(!t(r)){var n=m(t)(e.next()),i=n.left,o=n.right;return c({type:"anyBut",textArray:[r.text].concat(u()(i.textArray))},o)}throw new Error("Error occurred while parsing AnyBut,"+e.toString())}),(function(){return c({type:"anyBut",textArray:[]},e)}))}}function x(t){var e=function t(e){if(null===e.expression&&null===e.program)return[];var r=function(t){return e=t.Statement,l([{predicate:function(t){return!!t.Title},value:function(t){return e=t.Title,r=e.level,n=e.Seq,(u=document.createElement("h".concat(r))).appendChild(E(n)),u;var e,r,n,u}},{predicate:function(t){return!!t.Seq},value:function(t){return E(t.Seq)}}],document.createElement("div"))(e);var e}(e.expression),n=t(e.program);return[r].concat(u()(n))}(t),r=document.createElement("div");return e.forEach((function(t){return r.appendChild(t)})),r}function E(t){var e=document.createElement("div"),r=w(t);return 0===r.length?e.appendChild(document.createElement("br")):(r.forEach((function(t){return e.appendChild(t)})),e.setAttribute("style","display: flex; align-items: center"),e)}function w(t){if(t.isEmpty)return[];var e,r=(e=t.SeqTypes,l([{predicate:function(t){return!!t.Text},value:function(t){return e=t.Text,l([{predicate:function(t){return!!t.Italic},value:function(t){t.Italic}},{predicate:function(t){return!!t.Bold},value:function(t){return renderBold(t.Bold)}},{predicate:function(t){return!0},value:function(t){var e=t.text,r=document.createElement("pre");return r.innerHTML=e,r}}],document.createElement("div"))(e);var e}},{predicate:function(t){return!!t.Formula},value:function(t){return k(t.Formula)}},{predicate:function(t){return!!t.Link},value:function(t){return function(t){var e=t.LinkStat,r=t.link,n=document.createElement("a");n.setAttribute("href",r),r.includes("http")&&n.setAttribute("target","_blank");var i,o,c=(i=e,o=document.createElement("div"),function(t){if(t.isEmpty)return[];var e=l([{predicate:function(t){return!!t.AnyBut},value:function(t){return e=t.AnyBut,r=e.textArray,(n=document.createElement("pre")).innerHTML=r.join(""),n;var e,r,n}},{predicate:function(t){return!!t.Formula},value:function(t){return k(t.Formula)}}],document.createElement("div"))(t),r=w(t.LinkStat);return[e].concat(u()(r))}(i).forEach((function(t){return o.appendChild(t)})),o.setAttribute("style","display: block ruby;"),o);return n.appendChild(c),n}(t.Link)}}],document.createElement("div"))(e)),n=w(t.Seq);return[r].concat(u()(n))}function k(t){var e=o.a||{render:function(){}},r=t.equation,n=document.createElement("div");return n.setAttribute("style","flex-grow: 1"),e.render(r,n,{throwOnError:!1,displayMode:!t.isInline}),n}}])}));
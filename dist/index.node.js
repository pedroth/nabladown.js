!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.NablaDown=e():t.NablaDown=e()}(global,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e){t.exports=require("@babel/runtime/helpers/esm/toConsumableArray")},function(t,e){t.exports=require("katex")},function(t,e,r){"use strict";r.r(e),r.d(e,"parse",(function(){return v})),r.d(e,"render",(function(){return w}));var n=r(0),i=r.n(n),u=r(1),o=r.n(u);function c(t,e){return{left:t,right:e}}function a(t){var e=i()(t);return{next:function(){return a(e.slice(1))},peek:function(){return e[0]},hasNext:function(){return e.length>=1},isEmpty:function(){return 0===e.length},toString:function(){return e.map((function(t){return"string"==typeof t?t:JSON.stringify(t)})).join("")},filter:function(t){return a(e.filter(t))},log:function(){for(var t=a(e);t.hasNext();)console.log(t.peek()),t=t.next()}}}function f(){for(var t=null,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];for(var i=0;i<r.length;i++)try{return r[i]()}catch(e){t=e}throw t}function l(t,e){return function(r){for(var n=0;n<t.length;n++)if(t[n].predicate(r))return t[n].value(r);return e}}function p(t){return t.replaceAll('"',"'")}function s(t,e){return function(r){for(var n=e,i=r,u=[];i.peek()===t&&n>=0;)n--,u.push(i.peek()),i=i.next();var o=e-n;if(o>0)return c({type:t,repeat:o,text:u.join("")},i);throw new Error("Error occurred while tokening repeated #".concat(e,", with symbol ").concat(t," ")+i.toString())}}function d(t){return function(e){for(var r=i()(t),n=e,u=0;u<r.length;){if(n.peek()!==r[u])throw new Error("Error occurred while tokening unique symbol ".concat(t," ")+auxStream.toString());u++,n=n.next()}return c({type:t,repeat:1,text:t},n)}}function y(t){for(var e=i()("*#$[]()\n "),r=[],n=t;n.hasNext()&&!e.includes(n.peek());)r.push(n.peek()),n=n.next();return c({type:"text",text:r.join("")},n)}function v(t){var e=function t(e){return f((function(){var r=function(t){var e=function(t){return f((function(){var e=h(t);return c({type:"statement",Title:e.left},e.right)}),(function(){var e=m(t);return c({type:"statement",Seq:e.left},e.right)}))}(t),r=e.left,n=e.right;if("\n"===n.peek().type)return c({type:"expression",Statement:r},n.next());throw new Error("Error occurred while parsing expression,"+n.toString())}(e),n=r.left,i=r.right,u=t(i);return c({type:"program",expression:n,program:u.left},u.right)}),(function(){return c({type:"program",expression:null,program:null},e)}))}(function(t){for(var e=[],r=t;r.hasNext();){var n=f((function(){return s("#",6)(r)}),(function(){return s("$",2)(r)}),(function(){return s("*",2)(r)}),(function(){return s("+",3)(r)}),(function(){return d("\n")(r)}),(function(){return d("[")(r)}),(function(){return d("]")(r)}),(function(){return d("(")(r)}),(function(){return d(")")(r)}),(function(){return d(" ")(r)}),(function(){return y(r)})),i=n.left,u=n.right;e.push(i),r=u}return a(e)}(a(t)));return console.log("Parse tree",e.left),e.left}function h(t){if("#"===t.peek().type){var e=t.peek().repeat,r=m(" "===t.next().peek().type?t.next().next():t.next());return c({type:"title",Seq:r.left,level:e},r.right)}throw new Error("Error occurred while parsing Title,"+nextStream.toString())}function m(t){return f((function(){var e=g(t),r=e.left,n=m(e.right);return c({type:"seq",SeqTypes:r,Seq:n.left},n.right)}),(function(){return c({type:"seq",isEmpty:!0},t)}))}function g(t){return f((function(){var e=S(t);return c({type:"seqTypes",Formula:e.left},e.right)}),(function(){var e=function(t){var e=t.peek(),r=e.repeat,n=new Error("Error occurred while parsing Html,"+t.toString());if("+"===e.type&&3===r){var i=k((function(t){return["+"].includes(t.type)&&3===(null==t?void 0:t.repeat)}))(t.next()),u=i.left,o=i.right,a=o.peek();if("+"===a.type&&(null==a?void 0:a.repeat)===r)return c({type:"html",html:u.textArray.join("")},o.next())}throw n}(t);return c({type:"seqTypes",Html:e.left},e.right)}),(function(){var e=function(t){if("["===t.peek().type){var e=function t(e){return f((function(){return f((function(){var r=S(e),n=r.left,i=r.right,u=t(i);return c({type:"linkStat",Formula:n,LinkStat:u.left},u.right)}),(function(){var r=k((function(t){return["\n","]"].includes(t.type)}))(e),n=r.left,i=r.right;if(0===n.textArray.length)throw new Error("Error occurred while parsing LinkStat,"+e.toString());var u=t(i);return c({type:"linkStat",AnyBut:n,LinkStat:u.left},u.right)}))}),(function(){return c({type:"linkStat",isEmpty:!0},e)}))}(t.next()),r=e.left,n=e.right;if("]"===n.peek().type){var i=n.next();if("("===i.peek().type){var u=k((function(t){return["\n",")"].includes(t.type)}))(i.next()),o=u.left,a=u.right;if(")"===a.peek().type)return c({type:"link",LinkStat:r,link:o.textArray.join("")},a.next())}}}throw new Error("Error occurred while parsing Link,"+t.toString())}(t);return c({type:"seqTypes",Link:e.left},e.right)}),(function(){var e=x(t);return c({type:"seqTypes",Italic:e.left},e.right)}),(function(){var e=E(t);return c({type:"seqTypes",Bold:e.left},e.right)}),(function(){var e=function(t){var e=t.peek();if(!["\n"].some((function(t){return e.type===t}))){return c({type:"text",text:e.text||""},t.next())}throw new Error("Error occurred while parsing Text,"+t.toString())}(t);return c({type:"seqTypes",Text:e.left},e.right)}))}function x(t){var e=t.peek();if("*"===e.type&&1===e.repeat){var r=g(t.next()),n=r.left,i=r.right,u=i.peek();if("*"===u.type&&1===u.repeat)return c({type:"italic",SeqTypes:n},i.next())}throw new Error("Error occurred while parsing Italic,"+nextStream.toString())}function E(t){var e=t.peek();if("*"===e.type&&2===e.repeat){var r=g(t.next()),n=r.left,i=r.right,u=i.peek();if("*"===u.type&&2===u.repeat)return c({type:"bold",SeqTypes:n},i.next())}throw new Error("Error occurred while parsing Italic,"+nextStream.toString())}function S(t){var e=t.peek(),r=e.repeat,n=new Error("Error occurred while parsing Formula,"+t.toString());if("$"===e.type){var i=k((function(t){return["$"].includes(t.type)}))(t.next()),u=i.left,o=i.right,a=o.peek();if("$"===a.type&&(null==a?void 0:a.repeat)===r)return c({type:"formula",equation:u.textArray.join(""),isInline:1===(null==a?void 0:a.repeat)},o.next())}throw n}function k(t){return function(e){return f((function(){var r=e.peek();if(!t(r)){var n=k(t)(e.next()),u=n.left,o=n.right;return c({type:"anyBut",textArray:[r.text].concat(i()(u.textArray))},o)}throw new Error("Error occurred while parsing AnyBut,"+e.toString())}),(function(){return c({type:"anyBut",textArray:[]},e)}))}}function w(t){var e=function t(e){if(null===e.expression&&null===e.program)return[];var r=function(t){return e=t.Statement,l([{predicate:function(t){return!!t.Title},value:function(t){return e=t.Title,r=e.level,n=e.Seq,(i=document.createElement("h".concat(r))).appendChild(b(n)),i;var e,r,n,i}},{predicate:function(t){return!!t.Seq},value:function(t){return b(t.Seq)}}],document.createElement("div"))(e);var e}(e.expression),n=t(e.program);return[r].concat(i()(n))}(t),r=document.createElement("div");return e.forEach((function(t){return r.appendChild(t)})),r}function b(t){var e=document.createElement("div"),r=T(t);return 0===r.length?e.appendChild(document.createElement("br")):(r.forEach((function(t){return e.appendChild(t)})),e.setAttribute("style","display: flex; align-items: center"),e)}function T(t){if(t.isEmpty)return[];var e=q(t.SeqTypes),r=T(t.Seq);return[e].concat(i()(r))}function q(t){return l([{predicate:function(t){return!!t.Text},value:function(t){return e=t.Text,r=e.text,(n=document.createElement("pre")).innerHTML=r,n;var e,r,n}},{predicate:function(t){return!!t.Formula},value:function(t){return A(t.Formula)}},{predicate:function(t){return!!t.Html},value:function(t){return e=t.Html,r=e.html,(n=document.createElement("div")).innerHTML=r,Array.from(n.getElementsByTagName("script")).forEach((function(t){return e=t,n=eval,void((i=null==e||null===(r=e.attributes.src)||void 0===r?void 0:r.textContent)?fetch(i).then((function(t){return t.text()})).then((function(t){n(p(t))})):n(p(e.innerText)));var e,r,n,i})),n;var e,r,n}},{predicate:function(t){return!!t.Link},value:function(t){return function(t){var e=t.LinkStat,r=t.link,n=document.createElement("a");n.setAttribute("href",r),r.includes("http")&&n.setAttribute("target","_blank");var u=(o=e,c=document.createElement("div"),function(t){if(t.isEmpty)return[];var e=l([{predicate:function(t){return!!t.AnyBut},value:function(t){return e=t.AnyBut,r=e.textArray,(n=document.createElement("pre")).innerHTML=r.join(""),n;var e,r,n}},{predicate:function(t){return!!t.Formula},value:function(t){return A(t.Formula)}}],document.createElement("div"))(t),r=T(t.LinkStat);return[e].concat(i()(r))}(o).forEach((function(t){return c.appendChild(t)})),c.setAttribute("style","display: block ruby;"),c);var o,c;return n.appendChild(u),n}(t.Link)}},{predicate:function(t){return!!t.Italic},value:function(t){return e=t.Italic,r=e.SeqTypes,(n=document.createElement("em")).appendChild(q(r)),n;var e,r,n}},{predicate:function(t){return!!t.Bold},value:function(t){return e=t.Bold,r=e.SeqTypes,(n=document.createElement("strong")).appendChild(q(r)),n;var e,r,n}}],document.createElement("div"))(t)}function A(t){var e=o.a||{render:function(){}},r=t.equation,n=document.createElement("div");return t.isInline||n.setAttribute("style","flex-grow: 1"),e.render(r,n,{throwOnError:!1,displayMode:!t.isInline}),n}}])}));